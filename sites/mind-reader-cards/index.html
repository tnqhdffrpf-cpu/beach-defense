<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mind Reader Cards</title>
    <style>
      :root {
        --bg-a: #0a1022;
        --bg-b: #05070d;
        --panel: rgba(255, 255, 255, 0.08);
        --line: rgba(255, 255, 255, 0.2);
        --text: #f5f8ff;
        --muted: #b8c2dc;
        --gold: #f6cf64;
        --good: #6af2a5;
      }
      * { box-sizing: border-box; }
      body {
        margin: 0;
        min-height: 100vh;
        color: var(--text);
        font-family: "Avenir Next", "Segoe UI", sans-serif;
        background:
          radial-gradient(circle at 10% 0%, rgba(63, 102, 210, 0.35), transparent 34%),
          radial-gradient(circle at 90% 100%, rgba(132, 49, 167, 0.24), transparent 36%),
          linear-gradient(180deg, var(--bg-a), var(--bg-b));
      }
      .wrap {
        width: min(1000px, 95vw);
        margin: 0 auto;
        padding: 1rem 0 2rem;
      }
      .panel {
        border: 1px solid var(--line);
        border-radius: 18px;
        padding: 1rem;
        background: var(--panel);
        backdrop-filter: blur(6px);
        box-shadow: 0 14px 28px rgba(0, 0, 0, 0.25);
      }
      h1 { margin: 0; font-size: clamp(1.4rem, 3vw, 2rem); }
      .sub { margin: 0.45rem 0 0; color: var(--muted); }
      .top {
        display: flex;
        justify-content: space-between;
        gap: 0.8rem;
        align-items: end;
      }
      .timer {
        min-width: 92px;
        text-align: right;
      }
      .timer .n {
        font-size: 2.2rem;
        font-weight: 800;
        color: var(--gold);
        line-height: 1;
      }
      .bar {
        width: 100%;
        height: 7px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.15);
        overflow: hidden;
        margin-top: 0.4rem;
      }
      .bar > span {
        display: block;
        height: 100%;
        width: 100%;
        border-radius: inherit;
        background: linear-gradient(90deg, #f7de8f, #f3b93f);
        transition: width 180ms linear;
      }
      .hidden { display: none !important; }

      .stage {
        position: relative;
        margin-top: 1rem;
        height: min(54vw, 360px);
        min-height: 250px;
        border-radius: 14px;
        border: 1px solid rgba(255, 255, 255, 0.08);
        background:
          radial-gradient(circle at 50% 8%, rgba(255, 255, 255, 0.08), transparent 40%),
          rgba(0, 0, 0, 0.15);
        overflow: hidden;
      }

      .card-shell {
        position: absolute;
        width: min(14.6vw, 120px);
        aspect-ratio: 2.5 / 3.5;
        top: 50%;
        left: 50%;
        transform-style: preserve-3d;
        transition: transform 460ms cubic-bezier(0.23, 1, 0.32, 1), opacity 360ms ease;
        will-change: transform, opacity;
      }
      .card-inner {
        position: relative;
        width: 100%;
        height: 100%;
        transform-style: preserve-3d;
        transition: transform 430ms ease;
      }
      .card-shell.face-up .card-inner { transform: rotateY(180deg); }

      .card-face,
      .card-back {
        position: absolute;
        inset: 0;
        border-radius: 12px;
        backface-visibility: hidden;
        overflow: hidden;
      }
      .card-face {
        background: #fff;
        color: #11131a;
        border: 1px solid rgba(0, 0, 0, 0.14);
        transform: rotateY(180deg);
      }
      .card-face.red { color: #cc1f35; }
      .corner {
        position: absolute;
        font-size: clamp(0.92rem, 2vw, 1.12rem);
        font-weight: 800;
        line-height: 1;
      }
      .corner.tl { top: 7px; left: 7px; }
      .corner.br { bottom: 7px; right: 7px; transform: rotate(180deg); }
      .pip {
        position: absolute;
        inset: 0;
        display: grid;
        place-items: center;
        font-size: clamp(2.1rem, 5.2vw, 3.05rem); /* larger pips */
        font-weight: 800;
      }
      .card-back {
        background:
          linear-gradient(135deg, #1f56c5, #7b35ba),
          repeating-linear-gradient(45deg, rgba(255, 255, 255, 0.22) 0 6px, rgba(255, 255, 255, 0.1) 6px 12px);
        border: 1px solid rgba(255, 255, 255, 0.65);
        display: grid;
        place-items: center;
        color: white;
        font-size: 1.5rem;
      }

      .msg {
        margin-top: 0.75rem;
        text-align: center;
        color: var(--good);
        font-weight: 700;
      }
      .cta-row {
        display: flex;
        justify-content: center;
        margin-top: 1rem;
        gap: 0.7rem;
      }
      button, a.btn {
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: white;
        background: rgba(31, 88, 222, 0.85);
        border-radius: 11px;
        padding: 0.65rem 0.95rem;
        font-weight: 800;
        text-decoration: none;
        cursor: pointer;
      }
      a.btn.secondary { background: rgba(255, 255, 255, 0.1); }
    </style>
  </head>
  <body>
    <main class="wrap">
      <section class="panel">
        <div class="top">
          <div>
            <h1>Mind Reader Cards</h1>
            <p id="subtitle" class="sub">Think of one card. Keep it in your mind.</p>
          </div>
          <div id="timerWrap" class="timer">
            <div id="timerNum" class="n">5</div>
            <div class="bar"><span id="timerBar"></span></div>
          </div>
        </div>

        <div id="stage" class="stage"></div>
        <div id="resultMsg" class="msg hidden">I read your mind. Your card is gone.</div>

        <div class="cta-row">
          <button id="againBtn" class="hidden">Do It Again</button>
          <a class="btn secondary" href="../">Back to Project Hub</a>
        </div>
      </section>
    </main>

    <script>
      const openingCards = [
        { rank: "K", suit: "♥" },
        { rank: "7", suit: "♠" },
        { rank: "Q", suit: "♦" },
        { rank: "A", suit: "♣" },
        { rank: "10", suit: "♥" },
        { rank: "4", suit: "♠" }
      ];

      // None exactly match opening cards.
      const revealCards = [
        { rank: "K", suit: "♦" },
        { rank: "7", suit: "♣" },
        { rank: "Q", suit: "♥" },
        { rank: "A", suit: "♠" },
        { rank: "10", suit: "♣" }
      ];

      const subtitle = document.getElementById("subtitle");
      const timerWrap = document.getElementById("timerWrap");
      const timerNum = document.getElementById("timerNum");
      const timerBar = document.getElementById("timerBar");
      const stage = document.getElementById("stage");
      const resultMsg = document.getElementById("resultMsg");
      const againBtn = document.getElementById("againBtn");

      let intervalId = null;
      let cardsOnStage = [];

      function sleep(ms) {
        return new Promise((resolve) => setTimeout(resolve, ms));
      }

      function isRed(suit) {
        return suit === "♥" || suit === "♦";
      }

      function createCardElement(card, faceUp = true) {
        const shell = document.createElement("div");
        shell.className = "card-shell" + (faceUp ? " face-up" : "");

        const inner = document.createElement("div");
        inner.className = "card-inner";

        const face = document.createElement("div");
        face.className = "card-face" + (isRed(card.suit) ? " red" : "");
        face.innerHTML = `
          <div class="corner tl">${card.rank}<br>${card.suit}</div>
          <div class="pip">${card.suit}</div>
          <div class="corner br">${card.rank}<br>${card.suit}</div>
        `;

        const back = document.createElement("div");
        back.className = "card-back";
        back.textContent = "✦";

        inner.appendChild(face);
        inner.appendChild(back);
        shell.appendChild(inner);
        return shell;
      }

      function setCardFace(shell, card) {
        const face = shell.querySelector(".card-face");
        face.className = "card-face" + (isRed(card.suit) ? " red" : "");
        face.innerHTML = `
          <div class="corner tl">${card.rank}<br>${card.suit}</div>
          <div class="pip">${card.suit}</div>
          <div class="corner br">${card.rank}<br>${card.suit}</div>
        `;
      }

      function spreadPositions(count) {
        const w = stage.clientWidth;
        const center = w / 2;
        const spacing = Math.min(118, w / (count + 0.8));
        const start = center - ((count - 1) * spacing) / 2;
        return Array.from({ length: count }, (_, i) => ({
          x: start + i * spacing,
          rot: (i - (count - 1) / 2) * 4.5
        }));
      }

      function placeCards(cards, faceUp) {
        stage.innerHTML = "";
        cardsOnStage = cards.map((card) => createCardElement(card, faceUp));
        cardsOnStage.forEach((el) => stage.appendChild(el));
        const positions = spreadPositions(cardsOnStage.length);
        cardsOnStage.forEach((el, i) => moveCard(el, positions[i], 0));
      }

      function moveCard(el, pos, extraY = 0) {
        el.style.transform = `translate(-50%, -50%) translate(${pos.x - stage.clientWidth / 2}px, ${extraY}px) rotate(${pos.rot}deg)`;
      }

      async function runSelectionPhase() {
        subtitle.textContent = "Think of one card. Keep it in your mind.";
        timerWrap.classList.remove("hidden");
        resultMsg.classList.add("hidden");
        againBtn.classList.add("hidden");
        timerNum.textContent = "5";
        timerBar.style.width = "100%";
        placeCards(openingCards, true);

        let t = 5;
        intervalId = setInterval(() => {
          t -= 1;
          timerNum.textContent = String(Math.max(0, t));
          timerBar.style.width = `${(Math.max(0, t) / 5) * 100}%`;
        }, 1000);

        await sleep(5000);
        clearInterval(intervalId);
      }

      async function flipAllToBack() {
        for (let i = 0; i < cardsOnStage.length; i++) {
          cardsOnStage[i].classList.remove("face-up");
          await sleep(90);
        }
      }

      function shuffledIndices(n) {
        const arr = [...Array(n).keys()];
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
      }

      async function runShufflePhase() {
        subtitle.textContent = "I will remove the card you're thinking of...";
        timerWrap.classList.add("hidden");

        await flipAllToBack();
        await sleep(160);

        // Random shuffle bursts.
        for (let cycle = 0; cycle < 9; cycle++) {
          const order = shuffledIndices(cardsOnStage.length);
          const positions = spreadPositions(cardsOnStage.length);
          cardsOnStage.forEach((el, i) => {
            moveCard(el, positions[order[i]], (Math.random() - 0.5) * 16);
          });
          await sleep(140);
        }

        // Settle neatly in spread row.
        let positions = spreadPositions(cardsOnStage.length);
        cardsOnStage.forEach((el, i) => moveCard(el, positions[i], 0));
        await sleep(380);

        // Remove one card by sliding it out.
        const removeIndex = Math.floor(Math.random() * cardsOnStage.length);
        const removed = cardsOnStage[removeIndex];
        const removedPos = positions[removeIndex];
        removed.style.opacity = "0";
        removed.style.transform = `translate(-50%, -50%) translate(${removedPos.x - stage.clientWidth / 2}px, 180px) rotate(${removedPos.rot + 20}deg)`;
        await sleep(430);
        removed.remove();
        cardsOnStage.splice(removeIndex, 1);

        // Condense remaining five cards into final spread.
        positions = spreadPositions(cardsOnStage.length);
        cardsOnStage.forEach((el, i) => moveCard(el, positions[i], 0));
        await sleep(420);
      }

      async function runRevealPhase() {
        subtitle.textContent = "I read your mind.";

        // Replace face content while cards are face-down.
        cardsOnStage.forEach((el, i) => setCardFace(el, revealCards[i]));

        // Flip left -> right one-by-one.
        for (let i = 0; i < cardsOnStage.length; i++) {
          cardsOnStage[i].classList.add("face-up");
          await sleep(320);
        }

        resultMsg.classList.remove("hidden");
        againBtn.classList.remove("hidden");
      }

      async function startTrick() {
        clearInterval(intervalId);
        await runSelectionPhase();
        await runShufflePhase();
        await runRevealPhase();
      }

      againBtn.addEventListener("click", () => {
        startTrick();
      });

      window.addEventListener("resize", () => {
        if (!cardsOnStage.length) return;
        const pos = spreadPositions(cardsOnStage.length);
        cardsOnStage.forEach((el, i) => moveCard(el, pos[i], 0));
      });

      startTrick();
    </script>
  </body>
</html>
