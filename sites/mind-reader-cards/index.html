<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mind Reader Cards</title>
    <style>
      :root {
        --bg-a: #0a1022;
        --bg-b: #05070d;
        --panel: rgba(255, 255, 255, 0.08);
        --line: rgba(255, 255, 255, 0.2);
        --text: #f5f8ff;
        --muted: #b8c2dc;
        --gold: #f6cf64;
        --good: #6af2a5;
      }
      * { box-sizing: border-box; }
      body {
        margin: 0;
        min-height: 100vh;
        color: var(--text);
        font-family: "Avenir Next", "Segoe UI", sans-serif;
        background:
          radial-gradient(circle at 10% 0%, rgba(63, 102, 210, 0.35), transparent 34%),
          radial-gradient(circle at 90% 100%, rgba(132, 49, 167, 0.24), transparent 36%),
          linear-gradient(180deg, var(--bg-a), var(--bg-b));
      }
      .wrap {
        width: min(940px, 94vw);
        margin: 0 auto;
        padding: 1.2rem 0 2rem;
      }
      .panel {
        border: 1px solid var(--line);
        border-radius: 18px;
        padding: 1rem;
        background: var(--panel);
        backdrop-filter: blur(6px);
        box-shadow: 0 14px 28px rgba(0, 0, 0, 0.25);
      }
      h1 { margin: 0; font-size: clamp(1.45rem, 3vw, 2rem); }
      .sub { margin: 0.45rem 0 0; color: var(--muted); }
      .top {
        display: flex;
        justify-content: space-between;
        gap: 0.8rem;
        align-items: end;
        margin-bottom: 0.9rem;
      }
      .timer {
        min-width: 90px;
        text-align: right;
      }
      .timer .n {
        font-size: 2.2rem;
        font-weight: 800;
        color: var(--gold);
        line-height: 1;
      }
      .bar {
        width: 100%;
        height: 7px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.15);
        overflow: hidden;
        margin-top: 0.4rem;
      }
      .bar > span {
        display: block;
        height: 100%;
        width: 100%;
        border-radius: inherit;
        background: linear-gradient(90deg, #f7de8f, #f3b93f);
        transition: width 180ms linear;
      }
      .grid {
        display: grid;
        grid-template-columns: repeat(3, minmax(94px, 1fr));
        gap: 12px;
      }
      .card {
        aspect-ratio: 2.5 / 3.5;
        border-radius: 12px;
        background: #fff;
        border: 1px solid rgba(0, 0, 0, 0.14);
        color: #0f1118;
        position: relative;
        overflow: hidden;
        transform-style: preserve-3d;
        transition: transform 300ms ease, opacity 300ms ease;
      }
      .card.red { color: #cc1f35; }
      .rank {
        position: absolute;
        top: 8px;
        left: 8px;
        font-size: 1.05rem;
        font-weight: 800;
        line-height: 1.05;
      }
      .suit-big {
        position: absolute;
        inset: 0;
        display: grid;
        place-items: center;
        font-size: 2rem;
        font-weight: 700;
      }
      .back {
        background:
          linear-gradient(135deg, #1f56c5, #7b35ba),
          repeating-linear-gradient(45deg, rgba(255, 255, 255, 0.22) 0 6px, rgba(255, 255, 255, 0.1) 6px 12px);
        border: 1px solid rgba(255, 255, 255, 0.65);
        display: grid;
        place-items: center;
        color: white;
        font-size: 1.6rem;
      }
      .hidden { display: none !important; }
      .shuffle-stack {
        height: 260px;
        display: grid;
        place-items: center;
        position: relative;
      }
      .stack-card {
        width: min(32vw, 140px);
        aspect-ratio: 2.5 / 3.5;
        border-radius: 12px;
        position: absolute;
        transform-origin: center;
        transition: transform 350ms ease, opacity 350ms ease;
      }
      .shake {
        animation: shake 0.18s infinite alternate;
      }
      @keyframes shake {
        from { transform: translateX(-3px) rotate(-4deg); }
        to { transform: translateX(3px) rotate(4deg); }
      }
      .cta-row {
        display: flex;
        justify-content: center;
        margin-top: 1rem;
        gap: 0.7rem;
      }
      button, a.btn {
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: white;
        background: rgba(31, 88, 222, 0.85);
        border-radius: 11px;
        padding: 0.65rem 0.95rem;
        font-weight: 800;
        text-decoration: none;
        cursor: pointer;
      }
      button.secondary, a.btn.secondary {
        background: rgba(255, 255, 255, 0.1);
      }
      .msg {
        text-align: center;
        margin: 0.85rem 0 0.35rem;
        color: var(--good);
        font-weight: 700;
      }
    </style>
  </head>
  <body>
    <main class="wrap">
      <section class="panel">
        <div class="top">
          <div>
            <h1>Mind Reader Cards</h1>
            <p id="subtitle" class="sub">Think of one card. Keep it in your mind.</p>
          </div>
          <div id="timerWrap" class="timer">
            <div id="timerNum" class="n">5</div>
            <div class="bar"><span id="timerBar"></span></div>
          </div>
        </div>

        <div id="selectionGrid" class="grid"></div>

        <div id="shuffleView" class="shuffle-stack hidden"></div>

        <div id="revealGrid" class="grid hidden"></div>
        <div id="resultMsg" class="msg hidden">I read your mind. Your card is gone.</div>

        <div class="cta-row">
          <button id="againBtn" class="hidden">Do It Again</button>
          <a class="btn secondary" href="../">Back to Project Hub</a>
        </div>
      </section>
    </main>

    <script>
      const openingCards = [
        { rank: "K", suit: "♥" },
        { rank: "7", suit: "♠" },
        { rank: "Q", suit: "♦" },
        { rank: "A", suit: "♣" },
        { rank: "10", suit: "♥" },
        { rank: "4", suit: "♠" }
      ];

      // None exactly matches the opening set.
      const revealCards = [
        { rank: "K", suit: "♦" },
        { rank: "7", suit: "♣" },
        { rank: "Q", suit: "♥" },
        { rank: "A", suit: "♠" },
        { rank: "10", suit: "♣" }
      ];

      const subtitle = document.getElementById("subtitle");
      const timerWrap = document.getElementById("timerWrap");
      const timerNum = document.getElementById("timerNum");
      const timerBar = document.getElementById("timerBar");
      const selectionGrid = document.getElementById("selectionGrid");
      const shuffleView = document.getElementById("shuffleView");
      const revealGrid = document.getElementById("revealGrid");
      const resultMsg = document.getElementById("resultMsg");
      const againBtn = document.getElementById("againBtn");

      let intervalId = null;

      function isRed(suit) {
        return suit === "♥" || suit === "♦";
      }

      function makeFaceCard(card) {
        const el = document.createElement("div");
        el.className = `card ${isRed(card.suit) ? "red" : ""}`;
        el.innerHTML = `
          <div class="rank">${card.rank}<br>${card.suit}</div>
          <div class="suit-big">${card.suit}</div>
        `;
        return el;
      }

      function makeBackCard() {
        const el = document.createElement("div");
        el.className = "card back";
        el.textContent = "✦";
        return el;
      }

      function resetUI() {
        clearInterval(intervalId);
        subtitle.textContent = "Think of one card. Keep it in your mind.";
        timerWrap.classList.remove("hidden");
        timerNum.textContent = "5";
        timerBar.style.width = "100%";

        selectionGrid.classList.remove("hidden");
        selectionGrid.innerHTML = "";
        openingCards.forEach((c) => selectionGrid.appendChild(makeFaceCard(c)));

        shuffleView.classList.add("hidden");
        shuffleView.innerHTML = "";

        revealGrid.classList.add("hidden");
        revealGrid.innerHTML = "";

        resultMsg.classList.add("hidden");
        againBtn.classList.add("hidden");
      }

      function runSelectionPhase() {
        let t = 5;
        intervalId = setInterval(() => {
          t -= 1;
          timerNum.textContent = String(Math.max(0, t));
          timerBar.style.width = `${(Math.max(0, t) / 5) * 100}%`;
          if (t <= 0) {
            clearInterval(intervalId);
            runShufflePhase();
          }
        }, 1000);
      }

      function runShufflePhase() {
        subtitle.textContent = "I will remove the card you're thinking of...";
        timerWrap.classList.add("hidden");
        selectionGrid.classList.add("hidden");
        shuffleView.classList.remove("hidden");

        const stack = [];
        for (let i = 0; i < 6; i++) {
          const card = makeBackCard();
          card.classList.add("stack-card", "shake");
          card.style.transform = `translate(${(i - 2) * 10}px, ${(i % 2) * 6}px) rotate(${(i - 2) * 6}deg)`;
          shuffleView.appendChild(card);
          stack.push(card);
        }

        setTimeout(() => {
          // Remove one card from the stack.
          const removeTarget = stack[2];
          removeTarget.style.opacity = "0";
          removeTarget.style.transform += " scale(0.01)";
        }, 1200);

        setTimeout(() => {
          stack.forEach((c) => c.classList.remove("shake"));
          runRevealPhase();
        }, 2300);
      }

      function runRevealPhase() {
        subtitle.textContent = "I read your mind.";
        shuffleView.classList.add("hidden");
        revealGrid.classList.remove("hidden");
        revealGrid.innerHTML = "";

        const slots = revealCards.map(() => {
          const shell = document.createElement("div");
          shell.className = "card";
          revealGrid.appendChild(shell);
          return shell;
        });

        let i = 0;
        const flip = setInterval(() => {
          slots[i].replaceWith(makeFaceCard(revealCards[i]));
          i += 1;
          if (i >= revealCards.length) {
            clearInterval(flip);
            resultMsg.classList.remove("hidden");
            againBtn.classList.remove("hidden");
          }
        }, 320);
      }

      function startTrick() {
        resetUI();
        runSelectionPhase();
      }

      againBtn.addEventListener("click", startTrick);
      startTrick();
    </script>
  </body>
</html>
